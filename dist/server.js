import e from"https://esm.sh/react@18.1.0";import{DependencyGraph as Xt}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/graph.ts";import Vt from"./server_dependency_graph.js";import{revive as Y}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/routing.ts";import{createElement as Ke,useCallback as xe,useContext as Ye,useEffect as Qe,useMemo as Ze,useRef as qe,useState as be}from"https://esm.sh/react@18.1.0";import{FetchError as Z}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/error.ts";import{createContext as ae}from"https://esm.sh/react@18.1.0";var U=ae({url:new URL("http://localhost/"),params:{}});U.displayName="RouterContext";var Q=ae({data:void 0,isMutating:!1,mutation:{post:()=>Promise.resolve(new Response(null)),put:()=>Promise.resolve(new Response(null)),patch:()=>Promise.resolve(new Response(null)),delete:()=>Promise.resolve(new Response(null))},reload:()=>Promise.resolve(void 0)});Q.displayName="DataContext";var ve=ae({props:{}});ve.displayName="ForwardPropsContext";var Ee=({dataUrl:t,dataCache:r,children:o})=>{let i=qe(),[d,p]=be(()=>{let w=r.get(t);if(w){if(typeof w.data=="function"){let u=w.data();if(u instanceof Promise)return u.then(l=>{r.set(t,{data:l}),i.current=l}).catch(l=>{r.set(t,{data:l}),i.current=l});throw new Error(`Data for ${t} has invalid type [function].`)}return w.data}throw new Error(`Data for ${t} is not found`)}),[c,s]=be(!1),g=xe(async(w,u,l)=>{let m=l&&typeof l=="object"&&l!==null,y=m&&typeof l.optimisticUpdate=="function",C=l==="replace"||m&&!!l.replace,f;if(y){let T=l.optimisticUpdate;p(v=>v!==void 0?(f=v,T(et(v))):v)}s(w);let S=await u;if(S.status>=400){let T=await Z.fromResponse(S),v=T.details;if(T.status===501&&typeof v.redirect?.location=="string")return location.href=v.redirect?.location,S;if(y)return f!==void 0&&p(f),l.onFailure&&l.onFailure(T),s(!1),S;throw T}if(C&&S.ok)try{let T=await S.json(),v=r.get(t)?.dataCacheTtl;r.set(t,{data:T,dataCacheTtl:v,dataExpires:Date.now()+(v||1)*1e3}),p(T)}catch{y&&(f!==void 0&&p(f),l.onFailure&&l.onFailure(new Z(500,"Data must be valid JSON")))}return s(!1),S},[t]),h=xe(async w=>{try{let u=await fetch(t+(t.includes("?")?"&":"?")+"_data_",{headers:[["Accept","application/json"]],signal:w});if(!u.ok){let l=await Z.fromResponse(u),m=l.details;throw l.status===501&&typeof m.redirect?.location=="string"&&(location.href=m.redirect?.location,await new Promise(()=>{})),l}try{let l=await u.json(),m=u.headers.get("Cache-Control"),y=m&&m.includes("max-age=")?parseInt(m.split("max-age=")[1]):void 0,C=Date.now()+(y||1)*1e3;r.set(t,{data:l,dataExpires:C}),p(l)}catch{throw new Z(500,"Data must be valid JSON")}}catch(u){throw new Error(`Failed to reload data for ${t}: ${u.message}`)}},[t]),P=Ze(()=>({post:(w,u)=>g("post",q("post",t,w),u??"none"),put:(w,u)=>g("put",q("put",t,w),u??"none"),patch:(w,u)=>g("patch",q("patch",t,w),u??"none"),delete:(w,u)=>g("delete",q("delete",t,w),u??"none")}),[t]);return Qe(()=>{let w=Date.now(),u=r.get(t),l=null;return u===void 0||u.data!==void 0&&(u.dataExpires===void 0||u.dataExpires<w)?(l=new AbortController,h(l.signal).finally(()=>{l=null})):u.data!==void 0&&p(u.data),()=>l?.abort()},[t]),Ke(Q.Provider,{value:{deferedData:i,data:d,isMutating:c,mutation:P,reload:h}},o)},ie=()=>{let{deferedData:t,data:r,...o}=Ye(Q);if(r instanceof Error)throw r;if(r instanceof Promise){if(t?.current instanceof Error)throw t.current;if(t?.current!==void 0)return{...o,data:t.current};throw r}return{data:r,...o}};function q(t,r,o){let i,d=new Headers([["Accept","application/json"]]);return typeof o=="string"?i=o:typeof o=="number"?i=o.toString():typeof o=="object"&&(o instanceof ArrayBuffer||o instanceof Uint8Array||o instanceof FormData||o instanceof URLSearchParams?i=o:o instanceof Blob?(i=o,d.append("Content-Type",o.type)):(i=JSON.stringify(o),d.append("Content-Type","application/json; charset=utf-8"))),fetch(r,{method:t,body:i,headers:d})}function et(t){return t===null||typeof t!="object"?t:Array.isArray(t)?[...t]:{...t}}import{Children as tt,createElement as rt,Fragment as Pe,isValidElement as ot,useContext as nt,useEffect as st,useMemo as at}from"https://esm.sh/react@18.1.0";import V from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/util.ts";var K=t=>{let{ssrHeadCollection:r}=nt(U),[o,i]=at(()=>it(t.children),[t.children]);return r&&o.forEach(({type:d,props:p})=>{let{children:c,...s}=p;if(d==="title")V.isFilledString(c)?r.push(`<title ssr>${c}</title>`):V.isFilledArray(c)&&r.push(`<title ssr>${c.join("")}</title>`);else{let g=Object.entries(s).map(([h,P])=>` ${h}=${JSON.stringify(P)}`).join("");V.isFilledString(c)?r.push(`<${d}${g} ssr>${c}</${d}>`):V.isFilledArray(c)?r.push(`<${d}${g} ssr>${c.join("")}</${d}>`):r.push(`<${d}${g} ssr>`)}}),st(()=>{let{document:d}=window,p=[];return o.length>0&&o.forEach(({type:c,props:s})=>{let g=d.createElement(c);Object.keys(s).forEach(h=>{let P=s[h];h==="children"?V.isFilledString(P)?g.innerText=P:V.isFilledArray(P)&&(g.innerText=P.join("")):g.setAttribute(h,String(P||""))}),d.head.appendChild(g),p.push(g)}),()=>{p.forEach(c=>d.head.removeChild(c))}},[o]),rt(Pe,null,...i)};function it(t){let r=[],o=[],i=d=>{tt.forEach(d,p=>{if(!ot(p))return;let{type:c,props:s}=p;switch(c){case Pe:i(s.children);break;case"base":case"title":case"meta":case"link":case"style":if(["base","meta","link"].includes(c)&&"children"in s){let{children:g,...h}=s;r.push({type:c,props:h})}else r.push({type:c,props:s});break}})};return i(t),[r,o]}import{createElement as wt,useCallback as yt,useEffect as vt,useMemo as _e,useRef as xt}from"https://esm.sh/react@18.1.0";import W from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/util.ts";import bt from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/events.ts";import{redirect as Et}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/redirect.ts";import{createElement as _,StrictMode as ct,Suspense as ut,useContext as pt,useEffect as dt,useMemo as Ce,useState as Se}from"https://esm.sh/react@18.1.0";import O from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/events.ts";import{FetchError as Le}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/error.ts";import{redirect as ft}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/redirect.ts";import{matchRoutes as Te}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/route.ts";import{URLPatternCompat as ke}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/url_pattern.ts";import{Component as lt,createElement as ee}from"https://esm.sh/react@18.1.0";var te=class extends lt{constructor(r){super(r),this.state={error:null}}static getDerivedStateFromError(r){return{error:r}}render(){return this.state.error instanceof Error?ee(this.props.Handler,{error:this.state.error}):this.props.children}};function re({error:{status:t,message:r},fullscreen:o}){return ee("div",{style:o?{display:"flex",alignItems:"center",justifyContent:"center",width:"100vw",height:"100vh",fontSize:18}:{boxSizing:"border-box",width:"96%",height:"96%",margin:"auto",border:"1px solid rgba(255,0,0,0.5)",backgroundColor:"rgba(255,0,0,0.05)",borderRadius:"8px",padding:"1.5rem 2rem",color:"red",textAlign:"center"}},t&&ee("strong",{style:{fontWeight:"600"}},t),t&&ee("small",{style:{opacity:.5,padding:"0 6px"}},"-"),r)}var B=window,Me=t=>{let{ssrContext:r,dataDefer:o,strictMode:i,createPortal:d}=t,[p,c]=Se(()=>r?.url||new URL(window.location?.href)),[s,g]=Se(()=>r?.routeModules||ht()),h=Ce(()=>{let u=new Map;return s.forEach(({url:l,data:m,dataCacheTtl:y})=>{let C=l.pathname+l.search;m instanceof Promise?u.set(l.href,{data:Re(u,C,!0)}):u.set(C,{data:m,dataCacheTtl:y,dataExpires:Date.now()+(y||1)*1e3})}),u},[]),P=Ce(()=>{let u={};return s.forEach(l=>{Object.assign(u,l.params)}),u},[s]);if(dt(()=>{let{head:u,body:l}=window.document,m=Ne(),y=mt(),C=l.hasAttribute("data-defer")??o,f=l.getAttribute("data-deployment-id"),S=async({filename:k})=>{let x=k.slice(1);f&&(x+=`?v=${f}`);let{default:D,data:R,GET:N}=await import(x),F=Boolean(R??N);return m[k]={defaultExport:D,withData:F},{defaultExport:D,withData:F}},T=k=>{let x=new URL(k.href,location.href);Te(x,y).map(([R,N])=>{let{filename:F}=N;if(!(F in m)){let n=document.createElement("link"),a=N.filename.slice(1);f&&(a+=`?v=${f}`),n.setAttribute("rel","modulepreload"),n.setAttribute("href",a),document.head.appendChild(n)}})},v=async k=>{let x=k.url||new URL(window.location.href),D=Te(x,y),R=gt(),N=setTimeout(()=>{N=null,R.style.opacity="1",R.style.width="50%"},300),F=await Promise.all(D.map(async([n,a])=>{let{filename:E}=a,M={url:new URL(n.pathname.input+x.search,x.href),params:n.pathname.groups,filename:E},L=M.url.pathname+M.url.search;if(E in m)Object.assign(M,m[E]);else{let{defaultExport:X,withData:z}=await S(a);Object.assign(M,{defaultExport:X,withData:z})}return!h.has(L)&&m[E]?.withData===!0&&(M.withData=!0,await Re(h,L,C)),M}));g(F),c(x),setTimeout(()=>{if(N)clearTimeout(N),R.remove();else{let E=setTimeout(()=>{R.style.opacity="0"},700),M=setTimeout(()=>{B.__LOADING_BAR_CLEANUP=null,R.remove()},(.7+.3)*1e3);B.__LOADING_BAR_CLEANUP=()=>{clearTimeout(E),clearTimeout(M)},R.style.transition=`opacity ${.3}s ease-out, width ${.7}s ease-in-out`,setTimeout(()=>{R.style.width="100%"},0)}},0),k.url&&window.scrollTo(0,0)},b=k=>{let x=k.routePattern;if(x){let D=[new ke(x),{filename:k.specifier,pattern:x}],R=x.pathname.slice(1);(R==="_app"||R==="_404")&&(y[R]=D),y.routes.push(D)}},j=k=>{let D=y.routes.find(R=>R[1].filename===k.specifier)?.[1].pattern.pathname?.slice(1);(D==="_app"||D==="_404")&&(y[D]=void 0),y.routes=y.routes.filter(R=>R[1].filename!=k.specifier),v({type:"popstate"})};return addEventListener("popstate",v),O.on("popstate",v),O.on("moduleprefetch",T),O.on("hmr:create",b),O.on("hmr:remove",j),O.emit("routerready",{type:"routerready"}),Array.from(u.children).forEach(k=>{k.hasAttribute("ssr")&&u.removeChild(k)}),()=>{removeEventListener("popstate",v),O.off("popstate",v),O.off("moduleprefetch",T),O.off("hmr:create",b),O.off("hmr:remove",j)}},[]),s.length===0)return _(re,{error:{status:404,message:"page not found"},fullscreen:!0});let w=_(U.Provider,{value:{url:p,params:P,e404:s[s.length-1].url.pathname==="/_404"?!0:void 0,ssrHeadCollection:r?.headCollection,createPortal:d}},_(De,{modules:s,dataCache:h,ssrContext:r}));return i?_(ct,{},w):w},De=({modules:t,dataCache:r,ssrContext:o})=>{let{url:i,defaultExport:d,withData:p}=t[0],c=i.pathname+i.search,s;return typeof d=="function"?(s=_(d,null,t.length>1&&_(De,{modules:t.slice(1),dataCache:r,ssrContext:o})),p&&(s=_(ut,{fallback:null},_(Ee,{dataCache:r,dataUrl:c,key:c},s)))):s=_(re,{error:{status:500,message:"missing default export as a valid React component"}}),_(te,{Handler:re},s)},le=t=>_(Me,{...t,strictMode:!0}),ce=()=>{let{url:t,params:r,e404:o}=pt(U);return{url:t,params:r,e404:o,redirect:ft}};function mt(){let t=window.document?.getElementById("routes-manifest");if(t)try{let r=JSON.parse(t.innerText);if(Array.isArray(r.routes)){let o,i;return{routes:r.routes.map(p=>{let{pattern:c}=p,s=[new ke(c),p];return c.pathname==="/_app"?o=s:c.pathname==="/_404"&&(i=s),s}),_app:o,_404:i}}}catch(r){throw new Error(`loadRouteTableFromTag: ${r.message}`)}return{routes:[]}}async function Re(t,r,o){let i={},d=async()=>{let p=await fetch(r+(r.includes("?")?"&":"?")+"_data_",{headers:{Accept:"application/json"}});if(!p.ok){let c=await Le.fromResponse(p),s=c.details;if(c.status===501&&typeof s.redirect?.location=="string"){location.href=s.redirect?.location;return}return c}try{let c=await p.json(),s=p.headers.get("Cache-Control");return i.dataCacheTtl=s?.includes("max-age=")?parseInt(s.split("max-age=")[1]):void 0,i.dataExpires=Date.now()+(i.dataCacheTtl||1)*1e3,c}catch{return new Error("Data must be valid JSON")}};o?i.data=d:i.data=await d(),t.set(r,i)}function ht(){let t=window.document?.getElementById("ssr-modules");if(t)try{let r=JSON.parse(t.innerText);if(Array.isArray(r)){let o,i=Ne();return r.map(({url:d,filename:p,dataDefered:c,...s})=>{if(c){if(o===void 0){let g=window.document?.getElementById("defered-data");g?o=JSON.parse(g.innerText):o=null}o?s.data=o[d]:s.data=Promise.resolve(null)}return s.error&&(s.data=new Le(500,s.error.message,{stack:s.error.stack}),s.error=void 0),{url:new URL(d,location.href),filename:p,defaultExport:i[p].defaultExport,...s}})}}catch(r){throw new Error(`loadSSRModulesFromTag: ${r.message}`)}return[]}function Ne(){return B.__ROUTE_MODULES||(B.__ROUTE_MODULES={})}function gt(){typeof B.__LOADING_BAR_CLEANUP=="function"&&(B.__LOADING_BAR_CLEANUP(),B.__LOADING_BAR_CLEANUP=null);let t=document.getElementById("loading-bar");return t||(t=document.createElement("div"),t.id="loading-bar",document.body.appendChild(t)),Object.assign(t.style,{position:"fixed",top:"0",left:"0",zIndex:"9999",width:"0",height:"1px",opacity:"0",background:"rgba(128, 128, 128, 0.9)",transition:"opacity 0.6s ease-in, width 3s ease-in"}),t}var ue=new Set;function H(t){let{to:r,prefetch:o,replace:i,className:d,style:p,onClick:c,onMouseEnter:s,onMouseLeave:g,["aria-current"]:h,children:P,innerRef:w,...u}=t,{url:{pathname:l}}=ce(),m=_e(()=>{if(!W.isFilledString(r))throw new Error("<Link>: prop `to` is required.");if(W.isLikelyHttpURL(r))return r;let[b,j]=W.splitBy(r,"?");return b.startsWith("/")?b=W.cleanPath(b):b=W.cleanPath(l+"/"+b),[b,j].filter(Boolean).join("?")},[l,r]),y=_e(()=>{if(W.isFilledString(h))return h;if(m.startsWith("/"))return"page"},[m,h]),C=yt(()=>{!W.isLikelyHttpURL(m)&&!ue.has(m)&&(bt.emit("moduleprefetch",{href:m}),ue.add(m))},[m]),f=xt(null),S=b=>{typeof s=="function"&&s(b),!b.defaultPrevented&&!f.current&&!ue.has(m)&&(f.current=setTimeout(()=>{f.current=null,C()},150))},T=b=>{typeof g=="function"&&g(b),!b.defaultPrevented&&f.current&&(clearTimeout(f.current),f.current=null)},v=b=>{typeof c=="function"&&c(b),!(b.defaultPrevented||Pt(b))&&(b.preventDefault(),Et(m,i))};return vt(()=>(o&&C(),()=>{f.current&&(clearTimeout(f.current),f.current=null)}),[o,C]),wt("a",{...u,className:d,style:p,href:m,onClick:v,onMouseEnter:S,onMouseLeave:T,"aria-current":y,ref:w},P)}function Pt(t){let{target:r}=t.currentTarget,o=t.nativeEvent;return r&&r!=="_self"||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||o&&o.which===2}import{useContext as Tr,useEffect as Rr,useState as Lr}from"https://esm.sh/react@18.1.0";var pe=()=>e.createElement("div",{className:"screen e404"},e.createElement("h2",null,"Ooooooops, nothing here!"),e.createElement("p",null,e.createElement(H,{to:"/"},"Go back to the homepage"))),Ae=pe;function de(){return e.createElement("header",null,e.createElement("div",null,e.createElement("h1",null,e.createElement("a",null,e.createElement(H,{to:"/"},"\u3067\u3043\u30FC\u306E\u3057\u308A\u3068\u308A")))))}var fe=({children:t})=>e.createElement(e.Fragment,null,e.createElement(de,null),t),Fe=fe;import{useEffect as Ct,useState as oe}from"https://esm.sh/react@18.1.0";var G=({children:t,onClick:r,className:o})=>e.createElement("button",{onClick:r,className:o},t);var me=({show:t,setShow:r,title:o,content:i})=>{let d=()=>{r(!1)};return t?e.createElement("div",{className:"overlay",onClick:d},e.createElement("div",{className:"body",onClick:p=>p.stopPropagation()},e.createElement("div",{className:"header"},e.createElement("div",{className:"title"},o),e.createElement("div",{className:"close",onClick:d},e.createElement("img",{src:"../../public/close.svg",width:"20",height:"20",title:"closeIcon"}))),e.createElement("div",{className:"content"},i))):null};var St=t=>{let r="";return t.slice(-1)==="\u30FC"?r=t.slice(-2).slice(0,1):r=t.slice(-1),r==="\u3041"?"\u3042":r==="\u3043"?"\u3044":r==="\u3045"?"\u3046":r==="\u3047"?"\u3048":r==="\u3049"?"\u304A":r==="\u3063"?"\u3064":r==="\u3083"?"\u3084":r==="\u3085"?"\u3086":r==="\u3087"?"\u3088":r==="\u308E"?"\u308F":r},He=t=>Math.floor(Math.random()*t),ne=["\u3057\u308A\u3068\u308A","\u3067\u3043\u30FC\u306E","\u3058\u3050","\u3081\u304C\u306D","\u3055\u3070\u3048"],he={words:[{id:0,message:ne[He(ne.length)]}]},A={words:JSON.parse(window.localStorage?.getItem("words")||JSON.stringify(he.words))},Oe={cacheTtl:0,get:()=>A.words.length==0?he:A,put:async t=>{let{message:r}=await t.json();return typeof r=="string"&&(A.words.push({id:Date.now(),message:r}),window.localStorage?.setItem("words",JSON.stringify(A.words))),A},patch:async t=>{let{id:r,message:o}=await t.json(),i=A.words.find(d=>d.id===r);return i&&(typeof o=="string"&&(i.message=o),window.localStorage?.setItem("words",JSON.stringify(A.words))),A},delete:()=>(A.words=[{id:0,message:ne[He(ne.length)]}],window.localStorage?.setItem("words",JSON.stringify(A.words)),A)},ge=()=>{let{data:{words:o},isMutating:i,mutation:d}=ie(),[p,c]=oe([]),[s,g]=oe(!0),[h,P]=oe(!1),[w,u]=oe(!1);Ct(()=>{o.length>0&&c(o.map(y=>y.message).slice(-3))},[]);let l=()=>{P(!0),u(!0)},m=()=>{d.delete(void 0,"replace"),c(he.words.map(y=>y.message)),u(!1)};return e.createElement("div",{className:"screen game"},e.createElement(K,null,e.createElement("title",null,"Game"),e.createElement("meta",{name:"description",content:"\u3057\u308A\u3068\u308A\u3059\u308B"})),e.createElement("div",{className:"game-contents-container"},e.createElement("div",{className:"words-contents-container"},o.length>0&&e.createElement("div",{className:"recent-words-container"},o.length>1&&e.createElement("div",{className:"container"},e.createElement("div",{className:"recent-words"},p.map((y,C)=>e.createElement("p",{className:"recent-word"},o.length-p.length+C," ",y))),e.createElement("div",{className:"timer"},e.createElement("p",{className:"time"},"\u3042\u3068",e.createElement("br",null),e.createElement("span",null,"10"),"\u3073\u3087\u3046"))),e.createElement("p",{className:"most-recent-word"},o.length," ",e.createElement("span",null,o.slice(-1)[0].message)))),e.createElement("div",{className:"operation-conatainer"},w===!1&&e.createElement("form",{onSubmit:async y=>{y.preventDefault();let C=y.currentTarget,S=new FormData(C).get("message")?.toString().trim(),T=(S??"").charAt(0),v=St(o.slice(-1)[0].message);if(o.map(b=>b.message).includes(S??"")||/[ん]$/.test(S??""))return l();if(/[^ぁ-ん]ー/.test(S??""))return alert(`\u3072\u3089\u304C\u306A\u3092\u3064\u304B\u3063\u3066\u306D
`);if(T!==v)return alert("\u307E\u3048\u306E\u3053\u3068\u3070\u306B\u3064\u306A\u304C\u3063\u3066\u306A\u3044\u3088");(S??"").length<2&&alert("\u305D\u308C\u306F\u305A\u308B\u3044\u304B\u3089\u3084\u3081\u3066\u307B\u3057\u3044\u306A\u3041\u2026"),S&&(await d.put({message:S},{optimisticUpdate:b=>({words:[...b.words,{id:Date.now(),message:S}]}),replace:!0}),c(o.map(b=>b.message).slice(-3)),C.reset(),setTimeout(()=>{C.querySelector("input")?.focus()},0))}},e.createElement("input",{type:"text",name:"message",placeholder:"\u3064\u304E\u306E\u3053\u3068\u3070\u3092\u306B\u3085\u3046\u308A\u3087\u304F\u3057\u3066\u306D",autoFocus:!0,autoComplete:"off",disabled:!!i})),e.createElement("div",{className:"buttons"},e.createElement(G,{onClick:m},e.createElement(H,{role:"button",to:"/game"},"\u306F\u3058\u3081\u304B\u3089")),e.createElement(G,{onClick:()=>g(!0)},e.createElement("a",null,"\u308B\u30FC\u308B"))))),e.createElement(me,{title:"\u308B\u30FC\u308B",content:e.createElement("div",null,e.createElement("p",null,"\u3072\u3089\u304C\u306A\u3057\u304B\u3064\u304B\u3063\u3066\u306F\u3044\u3051\u307E\u305B\u3093\uFF0E",e.createElement("br",null),e.createElement("br",null),"\u304D\u3054\u3046\u3084\u3053\u3082\u3058\u3067\u304A\u3063\u308F\u305F\u3089",e.createElement("br",null),"\u201C\u3066\u304F\u306E\u308D\u3058\u30FC\u201D",e.createElement("br",null),"\u201D\u3058\u3057\u3087\u201D",e.createElement("br",null),"\u201D\u3088\u3046\u304B\u3093\u201D",e.createElement("br",null),"\u306E\u3088\u3046\u306B\u3061\u3087\u304F\u305C\u3093\u306E\u3082\u3058\u3084",e.createElement("br",null),"\u3053\u3082\u3058\u3092\u304A\u304A\u304D\u304F\u3057\u305F\u3082\u3058\u304B\u3089\u3064\u3065\u3051\u307E\u3057\u3087\u3046\uFF0E",e.createElement("br",null),e.createElement("br",null),"\u306A\u3093\u3068\u306A\u304F1\u3082\u3058\u306E\u3053\u3068\u3070\u306F",e.createElement("br",null),"\u305A\u308B\u3044\u304D\u304C\u3059\u308B\u306E\u3067\u3055\u3051\u3066\u304F\u3060\u3055\u3044\uFF0E",e.createElement("br",null),e.createElement("br",null),"\u3064\u304E\u306E\u3053\u3068\u3070\u3092\u3053\u305F\u3048\u308B\u307E\u3067\u306E",e.createElement("br",null),"\u305B\u3044\u3052\u3093\u3058\u304B\u3093\u306F",10,"\u3073\u3087\u3046\u3067\u3059\uFF0E",e.createElement("br",null),e.createElement("br",null),"\u304A\u306A\u3058\u3053\u3068\u3070\u306F1\u304B\u3044\u3060\u3051\uFF0E",e.createElement("br",null),e.createElement("br",null),"\u304C\u3093\u3070\u3063\u3066\u306D\uFF0E")),show:s,setShow:g}),e.createElement(me,{title:"\u3052\u30FC\u3080\u304A\u30FC\u3070\u30FC",content:e.createElement("div",null,e.createElement("p",null,o.length,"\u305F\u3093\u3054\u3082\u3064\u3065\u3044\u305F\u3088!",e.createElement("br",null),e.createElement("br",null),"\u307E\u305F\u3042\u305D\u3093\u3067\u306D\uFF0E"),e.createElement("div",{className:"game-over-buttons"},e.createElement(G,{onClick:()=>{P(!1),m()}},e.createElement("a",null,"\u306F\u3058\u3081\u304B\u3089")),e.createElement(G,{onClick:m},e.createElement(H,{role:"button",to:"/"},"\u3052\u30FC\u3080\u3068\u3063\u3077\u3078")))),show:h,setShow:P}))},$e=ge;import{useEffect as Tt}from"https://esm.sh/react@18.1.0";var we=()=>(Tt(()=>{(async()=>{let o=await(await fetch("/api/user")).json();console.log(o)})()},[]),e.createElement("div",{className:"screen index"},e.createElement(K,null,e.createElement("title",null,"deno-shiritori"),e.createElement("meta",{name:"description",content:"T\u3057\u308A\u3068\u308A\u3059\u308B"})),e.createElement("div",{className:"top-contents-container"},e.createElement("div",{className:"top-message"},e.createElement("h1",null,"\u3053\u3068\u3070\u3067\u3042\u305D\u307C\u3046"),e.createElement("p",null,"\u3067\u3043\u30FC\u306E\u3057\u308A\u3068\u308A\u3078\u3088\u3046\u3053\u305D",e.createElement("br",null)," \u3053\u3053\u3067\u306F\u3072\u3089\u304C\u306A\u3057\u304B\u3064\u304B\u3048\u307E\u305B\u3093",e.createElement("br",null)," \u3044\u3063\u3057\u3087\u306B\u3057\u308A\u3068\u308A\u3067\u3042\u305D\u3073\u307E\u3057\u3087\u3046")),e.createElement(G,null,e.createElement(H,{role:"button",to:"/game"},"\u3052\u30FC\u3080\u3059\u305F\u30FC\u3068"))))),Ie=we;var je=({response:t})=>{response.json({name:"Aleph"})};import{serve as Nt,serveTls as _t}from"https://deno.land/std@0.144.0/http/server.ts";import{readableStreamFromReader as At}from"https://deno.land/std@0.144.0/streams/conversion.ts";import{generateErrorHtml as J,TransformError as Ue}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/error.ts";import $ from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/log.ts";import{getContentType as Ft}from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/mime.ts";import Be from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/util.ts";import{createContext as Ht}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/context.ts";import{DependencyGraph as Ot}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/graph.ts";import{fixResponse as We,getAlephPkgUri as Ge,getDeploymentId as $t,globalIt as I,initModuleLoaders as It,loadImportMap as ye,loadJSXConfig as Je,regFullVersion as jt,setCookieHeader as No,toLocalPath as Xe}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/helpers.ts";import{loadAndFixIndexHtml as Ut}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/html.ts";import Bt from"https://deno.land/x/aleph@1.0.0-alpha.71/server/renderer.ts";import{fetchRouteData as Wt,initRoutes as Gt,revive as Ho}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/routing.ts";import{readableStreamFromReader as Rt}from"https://deno.land/std@0.144.0/streams/conversion.ts";import Lt from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/log.ts";import{builtinModuleExts as kt,getDeploymentId as Mt,regFullVersion as Dt}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/helpers.ts";var se={test:t=>t.startsWith("/-/")||kt.find(r=>t.endsWith(`.${r}`))&&!t.endsWith(".d.ts")||t.endsWith(".css"),fetch:async t=>{let o=Reflect.get(globalThis,"__ALEPH_CONFIG")?.build?.outputDir??"dist",{pathname:i,searchParams:d}=new URL(t.url);switch(i){case"/server.js":case"/server.js.map":case"/server_dependency_graph.js":return new Response("Not Found",{status:404})}try{let p=`./${o}${i}`,c="application/javascript; charset=utf-8";(d.has("module")||i.startsWith("/-/esm.sh/")&&!i.endsWith(".js")&&!i.endsWith(".css"))&&(p+=".js"),i.endsWith(".css")&&!d.has("module")&&(c="text/css; charset=utf-8");let s=new Headers({"Content-Type":c}),g=Mt(),h=null;if(g)h=`W/${btoa(i).replace(/[^a-z0-9]/g,"")}-${g}`;else{let w=await Deno.lstat(p);if(!w.isFile)return new Response("Not Found",{status:404});let{mtime:u,size:l}=w;u&&(h=`W/${u.getTime().toString(16)}-${l.toString(16)}`,s.append("Last-Modified",new Date(u).toUTCString()))}if(h&&t.headers.get("If-None-Match")===h)return new Response(null,{status:304});let P=await Deno.open(p,{read:!0});return h&&s.append("Etag",h),(d.get("v")||i.startsWith("/-/")&&Dt.test(i))&&s.append("Cache-Control","public, max-age=31536000, immutable"),new Response(Rt(P),{headers:s})}catch(p){return p instanceof Deno.errors.NotFound?new Response("Not Found",{status:404}):(Lt.error(p),new Response("Internal Server Error",{status:500}))}}};var Ve=(t={})=>{let{routes:r,unocss:o,build:i,devServer:d,middlewares:p,fetch:c,ssr:s,logLevel:g,onError:h}=t,P=Deno.env.get("ALEPH_ENV")==="development",w=async(f,S)=>{let T=new URL(f.url),{pathname:v,searchParams:b}=T;if(v==="/-/hmr"){let{socket:n,response:a}=Deno.upgradeWebSocket(f,{});return n.addEventListener("open",()=>{n.send(JSON.stringify({type:"reload"})),setTimeout(()=>{n.close()},50)}),a}let j=[],k=[],x=Ht(f,{connInfo:S,customHTMLRewriter:k});if(Array.isArray(p))for(let n=0,a=p.length;n<a;n++){let E=p[n],M=E.fetch;if(typeof M=="function")if(E.eager)try{let L=M(f,x);if(L instanceof Promise&&(L=await L),L instanceof Response)return L;typeof L=="function"&&setTimeout(L,0)}catch(L){let X=h?.(L,{by:"middleware",url:f.url,context:x});return X instanceof Response?X:($.error(`[middleare${E.name?`(${E.name})`:""}]`,L),new Response(J(L.stack??L.message),{status:500,headers:[["Content-Type","text/html"]]}))}else j.push(E)}if(se.test(v))try{let n=await I("__ALEPH_IMPORT_MAP",ye),a=await I("__ALEPH_JSX_CONFIG",()=>Je(n));return await se.fetch(f,{importMap:n,jsxConfig:a,buildTarget:i?.target,isDev:P})}catch(n){if(n instanceof Ue){let a=Xe(Ge());return new Response(`import { showTransformError } from "${a}/framework/core/error.ts";showTransformError(${JSON.stringify(n)});`,{headers:[["Content-Type","application/javascript"]]})}if(!(n instanceof Deno.errors.NotFound))return $.error(n),h?.(n,{by:"transplie",url:f.url})??new Response(J(n.stack??n.message),{status:500,headers:[["Content-Type","text/html"]]})}let R=(await I("__ALEPH_MODULE_LOADERS",It)).find(n=>n.test(v));if(R)try{let n=await I("__ALEPH_IMPORT_MAP",ye),a=await I("__ALEPH_JSX_CONFIG",()=>Je(n));return await se.fetch(f,{loader:R,importMap:n,jsxConfig:a,buildTarget:i?.target,isDev:P})}catch(n){if(n instanceof Ue){let a=Xe(Ge());return new Response(`import { showTransformError } from "${a}/framework/core/error.ts";showTransformError(${JSON.stringify(n)});`,{headers:[["Content-Type","application/javascript"]]})}if(!(n instanceof Deno.errors.NotFound))return $.error(n),h?.(n,{by:"transplie",url:f.url})??new Response(J(n.stack??n.message),{status:500,headers:[["Content-Type","text/html"]]})}let N=Ft(v);if(!v.startsWith("/.")&&N!=="application/octet-stream")try{let n=`.${v}`,a=await Deno.lstat(n);if(a.isDirectory&&v!=="/"&&(n=`${Be.trimSuffix(n,"/")}/index.html`,a=await Deno.lstat(n)),a.isFile){let E=new Headers({"Content-Type":N}),M=$t(),L=null;if(M)L=`W/${btoa(v).replace(/[^a-z0-9]/g,"")}-${M}`;else{let{mtime:z,size:ze}=a;z&&(L=`W/${z.getTime().toString(16)}-${ze.toString(16)}`,E.append("Last-Modified",new Date(z).toUTCString()))}if(L){if(f.headers.get("If-None-Match")===L)return new Response(null,{status:304});E.append("ETag",L)}(b.get("v")||jt.test(v))&&E.append("Cache-Control","public, max-age=31536000, immutable");let X=await Deno.open(n,{read:!0});return new Response(At(X),{headers:E})}}catch(n){if(!(n instanceof Deno.errors.NotFound))return $.error(n),h?.(n,{by:"fs",url:f.url})??new Response(J(n.stack??n.message),{status:500,headers:[["Content-Type","text/html"]]})}for(let n of j)try{let a=n.fetch(f,x);if(a instanceof Promise&&(a=await a),a instanceof Response)return a;typeof a=="function"&&setTimeout(a,0)}catch(a){let E=h?.(a,{by:"middleware",url:f.url,context:x});return E instanceof Response?E:($.error(`[middleare${n.name?`(${n.name})`:""}]`,a),new Response(J(a.stack??a.message),{status:500,headers:[["Content-Type","text/html"]]}))}if(typeof c=="function")return c(f,x);let F=await I("__ALEPH_ROUTES",()=>r?Gt(r):Promise.resolve({routes:[]}));if(F.routes.length>0){let n=f.method==="GET"&&(T.searchParams.has("_data_")||f.headers.get("Accept")==="application/json");try{let a=await Wt(F.routes,T,f,x,n);if(a)return a}catch(a){if(a instanceof TypeError&&!n)return new Response(J(a.stack??a.message),{status:500,headers:[["Content-Type","text/html"]]});let E=h?.(a,{by:"route-data-fetch",url:f.url,context:x});if(E instanceof Response)return We(E,x.headers,n);if(a instanceof Response)return We(a,x.headers,n);(a instanceof Error||typeof a=="string")&&$.error(a);let M=Be.isUint(a.status??a.code)?a.status??a.code:500;return Response.json({...a,status:M,message:a.message??String(a),stack:a.stack},{status:M,headers:x.headers})}}switch(v){case"/favicon.ico":case"/robots.txt":return new Response("Not found",{status:404})}try{let n=await I("__ALEPH_IMPORT_MAP",ye),a=await I("__ALEPH_INDEX_HTML",()=>Ut({isDev:P,importMap:n,ssr:typeof s=="function"?{}:s,hmrWebSocketUrl:t.devServer?.hmrWebSocketUrl}));return Bt.fetch(f,x,{indexHtml:a,routeTable:F,customHTMLRewriter:k,isDev:P,ssr:s})}catch(n){if(n instanceof Response)return n;let a;n instanceof Error?(a=n.stack,$.error("SSR",n)):a=n?.toString?.()||String(n);let E=s&&typeof s!="function"?s.cacheControl:"public";return x.headers.append("Cache-Control",`${E}, max-age=0, must-revalidate`),x.headers.append("Content-Type","text/html; charset=utf-8"),new Response(J(a,"SSR"),{headers:x.headers})}};g&&$.setLevel(g),Reflect.set(globalThis,"__ALEPH_CONFIG",{routes:r,unocss:o,build:i,devServer:d}),Reflect.set(globalThis,"__ALEPH_CLIENT_DEP_GRAPH",new Ot);let{hostname:u,port:l=8080,certFile:m,keyFile:y,signal:C}=t;Deno.env.get("ALEPH_CLI")?Reflect.set(globalThis,"__ALEPH_SERVER",{hostname:u,port:l,certFile:m,keyFile:y,handler:w,signal:C}):(m&&y?_t(w,{hostname:u,port:l,certFile:m,keyFile:y,signal:C}):Nt(w,{hostname:u,port:l,signal:C}),$.info(`Server ready on http://localhost:${l}`))};import{renderToReadableStream as Jt}from"https://esm.sh/react-dom@18.1.0/server";Ve({routes:"./src/pages/**/*.{tsx,ts}",ssr:{dataDefer:!1,render:t=>Jt(e.createElement(le,{ssrContext:t}),t)}});globalThis.__ALEPH_SERVER_DEP_GRAPH=new Xt(Vt.modules);Y("./src/pages/_404.tsx",{E404:pe,default:Ae});Y("./src/pages/_app.tsx",{App:fe,default:Fe});Y("./src/pages/game.tsx",{data:Oe,Game:ge,default:$e});Y("./src/pages/index.tsx",{Index:we,default:Ie});Y("./src/pages/api/user.ts",{handler:je});
//# sourceMappingURL=server.js.map
