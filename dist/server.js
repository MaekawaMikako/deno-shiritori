import e from"https://esm.sh/react@18.1.0";import{DependencyGraph as zt}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/graph.ts";import Kt from"./server_dependency_graph.js";import{revive as Q}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/routing.ts";import{createElement as Qe,useCallback as xe,useContext as Ze,useEffect as qe,useMemo as et,useRef as tt,useState as be}from"https://esm.sh/react@18.1.0";import{FetchError as q}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/error.ts";import{createContext as ae}from"https://esm.sh/react@18.1.0";var U=ae({url:new URL("http://localhost/"),params:{}});U.displayName="RouterContext";var Z=ae({data:void 0,isMutating:!1,mutation:{post:()=>Promise.resolve(new Response(null)),put:()=>Promise.resolve(new Response(null)),patch:()=>Promise.resolve(new Response(null)),delete:()=>Promise.resolve(new Response(null))},reload:()=>Promise.resolve(void 0)});Z.displayName="DataContext";var ve=ae({props:{}});ve.displayName="ForwardPropsContext";var Ce=({dataUrl:t,dataCache:r,children:o})=>{let s=tt(),[d,p]=be(()=>{let w=r.get(t);if(w){if(typeof w.data=="function"){let u=w.data();if(u instanceof Promise)return u.then(l=>{r.set(t,{data:l}),s.current=l}).catch(l=>{r.set(t,{data:l}),s.current=l});throw new Error(`Data for ${t} has invalid type [function].`)}return w.data}throw new Error(`Data for ${t} is not found`)}),[c,a]=be(!1),x=xe(async(w,u,l)=>{let h=l&&typeof l=="object"&&l!==null,b=h&&typeof l.optimisticUpdate=="function",L=l==="replace"||h&&!!l.replace,f;if(b){let E=l.optimisticUpdate;p(y=>y!==void 0?(f=y,E(rt(y))):y)}a(w);let D=await u;if(D.status>=400){let E=await q.fromResponse(D),y=E.details;if(E.status===501&&typeof y.redirect?.location=="string")return location.href=y.redirect?.location,D;if(b)return f!==void 0&&p(f),l.onFailure&&l.onFailure(E),a(!1),D;throw E}if(L&&D.ok)try{let E=await D.json(),y=r.get(t)?.dataCacheTtl;r.set(t,{data:E,dataCacheTtl:y,dataExpires:Date.now()+(y||1)*1e3}),p(E)}catch{b&&(f!==void 0&&p(f),l.onFailure&&l.onFailure(new q(500,"Data must be valid JSON")))}return a(!1),D},[t]),g=xe(async w=>{try{let u=await fetch(t+(t.includes("?")?"&":"?")+"_data_",{headers:[["Accept","application/json"]],signal:w});if(!u.ok){let l=await q.fromResponse(u),h=l.details;throw l.status===501&&typeof h.redirect?.location=="string"&&(location.href=h.redirect?.location,await new Promise(()=>{})),l}try{let l=await u.json(),h=u.headers.get("Cache-Control"),b=h&&h.includes("max-age=")?parseInt(h.split("max-age=")[1]):void 0,L=Date.now()+(b||1)*1e3;r.set(t,{data:l,dataExpires:L}),p(l)}catch{throw new q(500,"Data must be valid JSON")}}catch(u){throw new Error(`Failed to reload data for ${t}: ${u.message}`)}},[t]),S=et(()=>({post:(w,u)=>x("post",ee("post",t,w),u??"none"),put:(w,u)=>x("put",ee("put",t,w),u??"none"),patch:(w,u)=>x("patch",ee("patch",t,w),u??"none"),delete:(w,u)=>x("delete",ee("delete",t,w),u??"none")}),[t]);return qe(()=>{let w=Date.now(),u=r.get(t),l=null;return u===void 0||u.data!==void 0&&(u.dataExpires===void 0||u.dataExpires<w)?(l=new AbortController,g(l.signal).finally(()=>{l=null})):u.data!==void 0&&p(u.data),()=>l?.abort()},[t]),Qe(Z.Provider,{value:{deferedData:s,data:d,isMutating:c,mutation:S,reload:g}},o)},ie=()=>{let{deferedData:t,data:r,...o}=Ze(Z);if(r instanceof Error)throw r;if(r instanceof Promise){if(t?.current instanceof Error)throw t.current;if(t?.current!==void 0)return{...o,data:t.current};throw r}return{data:r,...o}};function ee(t,r,o){let s,d=new Headers([["Accept","application/json"]]);return typeof o=="string"?s=o:typeof o=="number"?s=o.toString():typeof o=="object"&&(o instanceof ArrayBuffer||o instanceof Uint8Array||o instanceof FormData||o instanceof URLSearchParams?s=o:o instanceof Blob?(s=o,d.append("Content-Type",o.type)):(s=JSON.stringify(o),d.append("Content-Type","application/json; charset=utf-8"))),fetch(r,{method:t,body:s,headers:d})}function rt(t){return t===null||typeof t!="object"?t:Array.isArray(t)?[...t]:{...t}}import{Children as ot,createElement as nt,Fragment as Ee,isValidElement as st,useContext as at,useEffect as it,useMemo as lt}from"https://esm.sh/react@18.1.0";import V from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/util.ts";var K=t=>{let{ssrHeadCollection:r}=at(U),[o,s]=lt(()=>ct(t.children),[t.children]);return r&&o.forEach(({type:d,props:p})=>{let{children:c,...a}=p;if(d==="title")V.isFilledString(c)?r.push(`<title ssr>${c}</title>`):V.isFilledArray(c)&&r.push(`<title ssr>${c.join("")}</title>`);else{let x=Object.entries(a).map(([g,S])=>` ${g}=${JSON.stringify(S)}`).join("");V.isFilledString(c)?r.push(`<${d}${x} ssr>${c}</${d}>`):V.isFilledArray(c)?r.push(`<${d}${x} ssr>${c.join("")}</${d}>`):r.push(`<${d}${x} ssr>`)}}),it(()=>{let{document:d}=window,p=[];return o.length>0&&o.forEach(({type:c,props:a})=>{let x=d.createElement(c);Object.keys(a).forEach(g=>{let S=a[g];g==="children"?V.isFilledString(S)?x.innerText=S:V.isFilledArray(S)&&(x.innerText=S.join("")):x.setAttribute(g,String(S||""))}),d.head.appendChild(x),p.push(x)}),()=>{p.forEach(c=>d.head.removeChild(c))}},[o]),nt(Ee,null,...s)};function ct(t){let r=[],o=[],s=d=>{ot.forEach(d,p=>{if(!st(p))return;let{type:c,props:a}=p;switch(c){case Ee:s(a.children);break;case"base":case"title":case"meta":case"link":case"style":if(["base","meta","link"].includes(c)&&"children"in a){let{children:x,...g}=a;r.push({type:c,props:g})}else r.push({type:c,props:a});break}})};return s(t),[r,o]}import{createElement as vt,useCallback as xt,useEffect as bt,useMemo as _e,useRef as Ct}from"https://esm.sh/react@18.1.0";import W from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/util.ts";import Et from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/events.ts";import{redirect as Pt}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/redirect.ts";import{createElement as A,StrictMode as pt,Suspense as dt,useContext as ft,useEffect as mt,useMemo as Pe,useState as Se}from"https://esm.sh/react@18.1.0";import $ from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/events.ts";import{FetchError as Le}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/error.ts";import{redirect as ht}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/redirect.ts";import{matchRoutes as Te}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/route.ts";import{URLPatternCompat as ke}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/url_pattern.ts";import{Component as ut,createElement as te}from"https://esm.sh/react@18.1.0";var re=class extends ut{constructor(r){super(r),this.state={error:null}}static getDerivedStateFromError(r){return{error:r}}render(){return this.state.error instanceof Error?te(this.props.Handler,{error:this.state.error}):this.props.children}};function oe({error:{status:t,message:r},fullscreen:o}){return te("div",{style:o?{display:"flex",alignItems:"center",justifyContent:"center",width:"100vw",height:"100vh",fontSize:18}:{boxSizing:"border-box",width:"96%",height:"96%",margin:"auto",border:"1px solid rgba(255,0,0,0.5)",backgroundColor:"rgba(255,0,0,0.05)",borderRadius:"8px",padding:"1.5rem 2rem",color:"red",textAlign:"center"}},t&&te("strong",{style:{fontWeight:"600"}},t),t&&te("small",{style:{opacity:.5,padding:"0 6px"}},"-"),r)}var B=window,Me=t=>{let{ssrContext:r,dataDefer:o,strictMode:s,createPortal:d}=t,[p,c]=Se(()=>r?.url||new URL(window.location?.href)),[a,x]=Se(()=>r?.routeModules||wt()),g=Pe(()=>{let u=new Map;return a.forEach(({url:l,data:h,dataCacheTtl:b})=>{let L=l.pathname+l.search;h instanceof Promise?u.set(l.href,{data:Re(u,L,!0)}):u.set(L,{data:h,dataCacheTtl:b,dataExpires:Date.now()+(b||1)*1e3})}),u},[]),S=Pe(()=>{let u={};return a.forEach(l=>{Object.assign(u,l.params)}),u},[a]);if(mt(()=>{let{head:u,body:l}=window.document,h=Ne(),b=gt(),L=l.hasAttribute("data-defer")??o,f=l.getAttribute("data-deployment-id"),D=async({filename:R})=>{let m=R.slice(1);f&&(m+=`?v=${f}`);let{default:N,data:P,GET:k}=await import(m),H=Boolean(P??k);return h[R]={defaultExport:N,withData:H},{defaultExport:N,withData:H}},E=R=>{let m=new URL(R.href,location.href);Te(m,b).map(([P,k])=>{let{filename:H}=k;if(!(H in h)){let n=document.createElement("link"),i=k.filename.slice(1);f&&(i+=`?v=${f}`),n.setAttribute("rel","modulepreload"),n.setAttribute("href",i),document.head.appendChild(n)}})},y=async R=>{let m=R.url||new URL(window.location.href),N=Te(m,b),P=yt(),k=setTimeout(()=>{k=null,P.style.opacity="1",P.style.width="50%"},300),H=await Promise.all(N.map(async([n,i])=>{let{filename:C}=i,M={url:new URL(n.pathname.input+m.search,m.href),params:n.pathname.groups,filename:C},T=M.url.pathname+M.url.search;if(C in h)Object.assign(M,h[C]);else{let{defaultExport:X,withData:z}=await D(i);Object.assign(M,{defaultExport:X,withData:z})}return!g.has(T)&&h[C]?.withData===!0&&(M.withData=!0,await Re(g,T,L)),M}));x(H),c(m),setTimeout(()=>{if(k)clearTimeout(k),P.remove();else{let C=setTimeout(()=>{P.style.opacity="0"},700),M=setTimeout(()=>{B.__LOADING_BAR_CLEANUP=null,P.remove()},(.7+.3)*1e3);B.__LOADING_BAR_CLEANUP=()=>{clearTimeout(C),clearTimeout(M)},P.style.transition=`opacity ${.3}s ease-out, width ${.7}s ease-in-out`,setTimeout(()=>{P.style.width="100%"},0)}},0),R.url&&window.scrollTo(0,0)},v=R=>{let m=R.routePattern;if(m){let N=[new ke(m),{filename:R.specifier,pattern:m}],P=m.pathname.slice(1);(P==="_app"||P==="_404")&&(b[P]=N),b.routes.push(N)}},_=R=>{let N=b.routes.find(P=>P[1].filename===R.specifier)?.[1].pattern.pathname?.slice(1);(N==="_app"||N==="_404")&&(b[N]=void 0),b.routes=b.routes.filter(P=>P[1].filename!=R.specifier),y({type:"popstate"})};return addEventListener("popstate",y),$.on("popstate",y),$.on("moduleprefetch",E),$.on("hmr:create",v),$.on("hmr:remove",_),$.emit("routerready",{type:"routerready"}),Array.from(u.children).forEach(R=>{R.hasAttribute("ssr")&&u.removeChild(R)}),()=>{removeEventListener("popstate",y),$.off("popstate",y),$.off("moduleprefetch",E),$.off("hmr:create",v),$.off("hmr:remove",_)}},[]),a.length===0)return A(oe,{error:{status:404,message:"page not found"},fullscreen:!0});let w=A(U.Provider,{value:{url:p,params:S,e404:a[a.length-1].url.pathname==="/_404"?!0:void 0,ssrHeadCollection:r?.headCollection,createPortal:d}},A(De,{modules:a,dataCache:g,ssrContext:r}));return s?A(pt,{},w):w},De=({modules:t,dataCache:r,ssrContext:o})=>{let{url:s,defaultExport:d,withData:p}=t[0],c=s.pathname+s.search,a;return typeof d=="function"?(a=A(d,null,t.length>1&&A(De,{modules:t.slice(1),dataCache:r,ssrContext:o})),p&&(a=A(dt,{fallback:null},A(Ce,{dataCache:r,dataUrl:c,key:c},a)))):a=A(oe,{error:{status:500,message:"missing default export as a valid React component"}}),A(re,{Handler:oe},a)},le=t=>A(Me,{...t,strictMode:!0}),ce=()=>{let{url:t,params:r,e404:o}=ft(U);return{url:t,params:r,e404:o,redirect:ht}};function gt(){let t=window.document?.getElementById("routes-manifest");if(t)try{let r=JSON.parse(t.innerText);if(Array.isArray(r.routes)){let o,s;return{routes:r.routes.map(p=>{let{pattern:c}=p,a=[new ke(c),p];return c.pathname==="/_app"?o=a:c.pathname==="/_404"&&(s=a),a}),_app:o,_404:s}}}catch(r){throw new Error(`loadRouteTableFromTag: ${r.message}`)}return{routes:[]}}async function Re(t,r,o){let s={},d=async()=>{let p=await fetch(r+(r.includes("?")?"&":"?")+"_data_",{headers:{Accept:"application/json"}});if(!p.ok){let c=await Le.fromResponse(p),a=c.details;if(c.status===501&&typeof a.redirect?.location=="string"){location.href=a.redirect?.location;return}return c}try{let c=await p.json(),a=p.headers.get("Cache-Control");return s.dataCacheTtl=a?.includes("max-age=")?parseInt(a.split("max-age=")[1]):void 0,s.dataExpires=Date.now()+(s.dataCacheTtl||1)*1e3,c}catch{return new Error("Data must be valid JSON")}};o?s.data=d:s.data=await d(),t.set(r,s)}function wt(){let t=window.document?.getElementById("ssr-modules");if(t)try{let r=JSON.parse(t.innerText);if(Array.isArray(r)){let o,s=Ne();return r.map(({url:d,filename:p,dataDefered:c,...a})=>{if(c){if(o===void 0){let x=window.document?.getElementById("defered-data");x?o=JSON.parse(x.innerText):o=null}o?a.data=o[d]:a.data=Promise.resolve(null)}return a.error&&(a.data=new Le(500,a.error.message,{stack:a.error.stack}),a.error=void 0),{url:new URL(d,location.href),filename:p,defaultExport:s[p].defaultExport,...a}})}}catch(r){throw new Error(`loadSSRModulesFromTag: ${r.message}`)}return[]}function Ne(){return B.__ROUTE_MODULES||(B.__ROUTE_MODULES={})}function yt(){typeof B.__LOADING_BAR_CLEANUP=="function"&&(B.__LOADING_BAR_CLEANUP(),B.__LOADING_BAR_CLEANUP=null);let t=document.getElementById("loading-bar");return t||(t=document.createElement("div"),t.id="loading-bar",document.body.appendChild(t)),Object.assign(t.style,{position:"fixed",top:"0",left:"0",zIndex:"9999",width:"0",height:"1px",opacity:"0",background:"rgba(128, 128, 128, 0.9)",transition:"opacity 0.6s ease-in, width 3s ease-in"}),t}var ue=new Set;function O(t){let{to:r,prefetch:o,replace:s,className:d,style:p,onClick:c,onMouseEnter:a,onMouseLeave:x,["aria-current"]:g,children:S,innerRef:w,...u}=t,{url:{pathname:l}}=ce(),h=_e(()=>{if(!W.isFilledString(r))throw new Error("<Link>: prop `to` is required.");if(W.isLikelyHttpURL(r))return r;let[v,_]=W.splitBy(r,"?");return v.startsWith("/")?v=W.cleanPath(v):v=W.cleanPath(l+"/"+v),[v,_].filter(Boolean).join("?")},[l,r]),b=_e(()=>{if(W.isFilledString(g))return g;if(h.startsWith("/"))return"page"},[h,g]),L=xt(()=>{!W.isLikelyHttpURL(h)&&!ue.has(h)&&(Et.emit("moduleprefetch",{href:h}),ue.add(h))},[h]),f=Ct(null),D=v=>{typeof a=="function"&&a(v),!v.defaultPrevented&&!f.current&&!ue.has(h)&&(f.current=setTimeout(()=>{f.current=null,L()},150))},E=v=>{typeof x=="function"&&x(v),!v.defaultPrevented&&f.current&&(clearTimeout(f.current),f.current=null)},y=v=>{typeof c=="function"&&c(v),!(v.defaultPrevented||St(v))&&(v.preventDefault(),Pt(h,s))};return bt(()=>(o&&L(),()=>{f.current&&(clearTimeout(f.current),f.current=null)}),[o,L]),vt("a",{...u,className:d,style:p,href:h,onClick:y,onMouseEnter:D,onMouseLeave:E,"aria-current":b,ref:w},S)}function St(t){let{target:r}=t.currentTarget,o=t.nativeEvent;return r&&r!=="_self"||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||o&&o.which===2}import{useContext as Lr,useEffect as kr,useState as Mr}from"https://esm.sh/react@18.1.0";var pe=()=>e.createElement("div",{className:"screen e404"},e.createElement("h2",null,"Ooooooops, nothing here!"),e.createElement("p",null,e.createElement(O,{to:"/"},"Go back to the homepage"))),Ae=pe;function de(){return e.createElement("header",null,e.createElement("div",null,e.createElement("h1",null,e.createElement("a",null,e.createElement(O,{to:"/"},"\u3067\u3043\u30FC\u306E\u3057\u308A\u3068\u308A")))))}var fe=({children:t})=>e.createElement(e.Fragment,null,e.createElement(de,null),t),Fe=fe;import{useCallback as He,useEffect as Oe,useRef as Tt,useState as Y}from"https://esm.sh/react@18.1.0";var G=({children:t,onClick:r,className:o})=>e.createElement("button",{onClick:r,className:o},t);var me=({show:t,setShow:r,title:o,content:s})=>{let d=()=>{r(!1)};return t?e.createElement("div",{className:"overlay",onClick:d},e.createElement("div",{className:"body",onClick:p=>p.stopPropagation()},e.createElement("div",{className:"header"},e.createElement("div",{className:"title"},o),e.createElement("div",{className:"close",onClick:d},e.createElement("img",{src:"../../public/close.svg",width:"20",height:"20",title:"closeIcon"}))),e.createElement("div",{className:"content"},s))):null};var Rt=t=>{let r="";return t.slice(-1)==="\u30FC"?r=t.slice(-2).slice(0,1):r=t.slice(-1),r==="\u3041"?"\u3042":r==="\u3043"?"\u3044":r==="\u3045"?"\u3046":r==="\u3047"?"\u3048":r==="\u3049"?"\u304A":r==="\u3063"?"\u3064":r==="\u3083"?"\u3084":r==="\u3085"?"\u3086":r==="\u3087"?"\u3088":r==="\u308E"?"\u308F":r},$e=t=>Math.floor(Math.random()*t),ne=["\u3057\u308A\u3068\u308A","\u3067\u3043\u30FC\u306E","\u3058\u3050","\u3081\u304C\u306D","\u3055\u3070\u3048"],he={words:[{id:0,message:ne[$e(ne.length)]}]},F={words:JSON.parse(window.localStorage?.getItem("words")||JSON.stringify(he.words))},Ie={cacheTtl:0,get:()=>F.words.length==0?he:F,put:async t=>{let{message:r}=await t.json();return typeof r=="string"&&(F.words.push({id:Date.now(),message:r}),window.localStorage?.setItem("words",JSON.stringify(F.words))),F},patch:async t=>{let{id:r,message:o}=await t.json(),s=F.words.find(d=>d.id===r);return s&&(typeof o=="string"&&(s.message=o),window.localStorage?.setItem("words",JSON.stringify(F.words))),F},delete:()=>(F.words=[{id:0,message:ne[$e(ne.length)]}],window.localStorage?.setItem("words",JSON.stringify(F.words)),F)},ge=()=>{let o=Tt(null),{data:{words:s},isMutating:d,mutation:p}=ie(),[c,a]=Y([]),[x,g]=Y(!0),[S,w]=Y(!1),[u,l]=Y(!1),[h,b]=Y(5);Oe(()=>{s.length>0&&a(s.map(v=>v.message).slice(-3))},[]),Oe(()=>{h===0&&E()},[h]);let L=He(()=>{o.current===null&&(o.current=setInterval(()=>{b(v=>v-1)},1e3))},[]),f=He(()=>{o.current!==null&&(clearInterval(o.current),o.current=null)},[]),D=()=>{b(5),L()},E=()=>{w(!0),l(!0),f()},y=()=>{p.delete(void 0,"replace"),a(he.words.map(v=>v.message)),l(!1),f()};return e.createElement("div",{className:"screen game"},e.createElement(K,null,e.createElement("title",null,"Game"),e.createElement("meta",{name:"description",content:"\u3057\u308A\u3068\u308A\u3059\u308B"})),e.createElement("div",{className:"game-contents-container"},e.createElement("div",{className:"words-contents-container"},s.length>0&&e.createElement("div",{className:"recent-words-container"},s.length>1&&e.createElement("div",{className:"container"},e.createElement("div",{className:"recent-words"},c.map((v,_)=>e.createElement("p",{className:"recent-word"},s.length-c.length+_," ",v))),e.createElement("div",{className:"timer"},e.createElement("p",{className:"time"},"\u3042\u3068",e.createElement("br",null),e.createElement("span",null,h),"\u3073\u3087\u3046"))),e.createElement("p",{className:"most-recent-word"},s.length," ",e.createElement("span",null,s.slice(-1)[0].message)))),e.createElement("div",{className:"operation-conatainer"},u===!1&&e.createElement("form",{onSubmit:async v=>{v.preventDefault();let _=v.currentTarget,m=new FormData(_).get("message")?.toString().trim(),N=(m??"").charAt(0),P=Rt(s.slice(-1)[0].message);if(s.map(k=>k.message).includes(m??"")||/[ん]$/.test(m??""))return E();if(/[^ぁ-ん]ー/.test(m??""))return alert(`\u3072\u3089\u304C\u306A\u3092\u3064\u304B\u3063\u3066\u306D
`);if(N!==P)return alert("\u307E\u3048\u306E\u3053\u3068\u3070\u306B\u3064\u306A\u304C\u3063\u3066\u306A\u3044\u3088");(m??"").length<2&&alert("\u305D\u308C\u306F\u305A\u308B\u3044\u304B\u3089\u3084\u3081\u3066\u307B\u3057\u3044\u306A\u3041\u2026"),m&&(await p.put({message:m},{optimisticUpdate:k=>({words:[...k.words,{id:Date.now(),message:m}]}),replace:!0}),a(s.map(k=>k.message).slice(-3)),D(),_.reset(),setTimeout(()=>{_.querySelector("input")?.focus()},0))}},e.createElement("input",{type:"text",name:"message",placeholder:"\u3064\u304E\u306E\u3053\u3068\u3070\u3092\u306B\u3085\u3046\u308A\u3087\u304F\u3057\u3066\u306D",autoFocus:!0,autoComplete:"off",disabled:!!d})),e.createElement("div",{className:"buttons"},e.createElement(G,{onClick:y},e.createElement(O,{role:"button",to:"/game"},"\u306F\u3058\u3081\u304B\u3089")),e.createElement(G,{onClick:()=>g(!0)},e.createElement("a",null,"\u308B\u30FC\u308B"))))),e.createElement(me,{title:"\u308B\u30FC\u308B",content:e.createElement("div",null,e.createElement("p",null,"\u3072\u3089\u304C\u306A\u3057\u304B\u3064\u304B\u3063\u3066\u306F\u3044\u3051\u307E\u305B\u3093\uFF0E",e.createElement("br",null),e.createElement("br",null),"\u304D\u3054\u3046\u3084\u3053\u3082\u3058\u3067\u304A\u3063\u308F\u305F\u3089",e.createElement("br",null),"\u201C\u3066\u304F\u306E\u308D\u3058\u30FC\u201D",e.createElement("br",null),"\u201D\u3058\u3057\u3087\u201D",e.createElement("br",null),"\u201D\u3088\u3046\u304B\u3093\u201D",e.createElement("br",null),"\u306E\u3088\u3046\u306B\u3061\u3087\u304F\u305C\u3093\u306E\u3082\u3058\u3084",e.createElement("br",null),"\u3053\u3082\u3058\u3092\u304A\u304A\u304D\u304F\u3057\u305F\u3082\u3058\u304B\u3089\u3064\u3065\u3051\u307E\u3057\u3087\u3046\uFF0E",e.createElement("br",null),e.createElement("br",null),"\u306A\u3093\u3068\u306A\u304F1\u3082\u3058\u306E\u3053\u3068\u3070\u306F",e.createElement("br",null),"\u305A\u308B\u3044\u304D\u304C\u3059\u308B\u306E\u3067\u3055\u3051\u3066\u304F\u3060\u3055\u3044\uFF0E",e.createElement("br",null),e.createElement("br",null),"\u3064\u304E\u306E\u3053\u3068\u3070\u3092\u3053\u305F\u3048\u308B\u307E\u3067\u306E",e.createElement("br",null),"\u305B\u3044\u3052\u3093\u3058\u304B\u3093\u306F",5,"\u3073\u3087\u3046\u3067\u3059\uFF0E",e.createElement("br",null),e.createElement("br",null),"\u304A\u306A\u3058\u3053\u3068\u3070\u306F1\u304B\u3044\u3060\u3051\uFF0E",e.createElement("br",null),e.createElement("br",null),"\u304C\u3093\u3070\u3063\u3066\u306D\uFF0E")),show:x,setShow:g}),e.createElement(me,{title:"\u3052\u30FC\u3080\u304A\u30FC\u3070\u30FC",content:e.createElement("div",null,e.createElement("p",null,s.length,"\u305F\u3093\u3054\u3082\u3064\u3065\u3044\u305F\u3088!",e.createElement("br",null),e.createElement("br",null),"\u307E\u305F\u3042\u305D\u3093\u3067\u306D\uFF0E"),e.createElement("div",{className:"game-over-buttons"},e.createElement(G,{onClick:()=>{w(!1),y()}},e.createElement("a",null,"\u306F\u3058\u3081\u304B\u3089")),e.createElement(G,{onClick:y},e.createElement(O,{role:"button",to:"/"},"\u3052\u30FC\u3080\u3068\u3063\u3077\u3078")))),show:S,setShow:w}))},je=ge;import{useEffect as Lt}from"https://esm.sh/react@18.1.0";var we=()=>(Lt(()=>{(async()=>{let o=await(await fetch("/api/user")).json();console.log(o)})()},[]),e.createElement("div",{className:"screen index"},e.createElement(K,null,e.createElement("title",null,"deno-shiritori"),e.createElement("meta",{name:"description",content:"T\u3057\u308A\u3068\u308A\u3059\u308B"})),e.createElement("div",{className:"top-contents-container"},e.createElement("div",{className:"top-message"},e.createElement("h1",null,"\u3053\u3068\u3070\u3067\u3042\u305D\u307C\u3046"),e.createElement("p",null,"\u3067\u3043\u30FC\u306E\u3057\u308A\u3068\u308A\u3078\u3088\u3046\u3053\u305D",e.createElement("br",null)," \u3053\u3053\u3067\u306F\u3072\u3089\u304C\u306A\u3057\u304B\u3064\u304B\u3048\u307E\u305B\u3093",e.createElement("br",null)," \u3044\u3063\u3057\u3087\u306B\u3057\u308A\u3068\u308A\u3067\u3042\u305D\u3073\u307E\u3057\u3087\u3046")),e.createElement(G,null,e.createElement(O,{role:"button",to:"/game"},"\u3052\u30FC\u3080\u3059\u305F\u30FC\u3068"))))),Ue=we;var Be=({response:t})=>{response.json({name:"Aleph"})};import{serve as At,serveTls as Ft}from"https://deno.land/std@0.144.0/http/server.ts";import{readableStreamFromReader as Ht}from"https://deno.land/std@0.144.0/streams/conversion.ts";import{generateErrorHtml as J,TransformError as We}from"https://deno.land/x/aleph@1.0.0-alpha.71/framework/core/error.ts";import I from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/log.ts";import{getContentType as Ot}from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/mime.ts";import Ge from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/util.ts";import{createContext as $t}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/context.ts";import{DependencyGraph as It}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/graph.ts";import{fixResponse as Je,getAlephPkgUri as Xe,getDeploymentId as jt,globalIt as j,initModuleLoaders as Ut,loadImportMap as ye,loadJSXConfig as Ve,regFullVersion as Bt,setCookieHeader as Ao,toLocalPath as ze}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/helpers.ts";import{loadAndFixIndexHtml as Wt}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/html.ts";import Gt from"https://deno.land/x/aleph@1.0.0-alpha.71/server/renderer.ts";import{fetchRouteData as Jt,initRoutes as Xt,revive as $o}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/routing.ts";import{readableStreamFromReader as kt}from"https://deno.land/std@0.144.0/streams/conversion.ts";import Mt from"https://deno.land/x/aleph@1.0.0-alpha.71/lib/log.ts";import{builtinModuleExts as Dt,getDeploymentId as Nt,regFullVersion as _t}from"https://deno.land/x/aleph@1.0.0-alpha.71/server/helpers.ts";var se={test:t=>t.startsWith("/-/")||Dt.find(r=>t.endsWith(`.${r}`))&&!t.endsWith(".d.ts")||t.endsWith(".css"),fetch:async t=>{let o=Reflect.get(globalThis,"__ALEPH_CONFIG")?.build?.outputDir??"dist",{pathname:s,searchParams:d}=new URL(t.url);switch(s){case"/server.js":case"/server.js.map":case"/server_dependency_graph.js":return new Response("Not Found",{status:404})}try{let p=`./${o}${s}`,c="application/javascript; charset=utf-8";(d.has("module")||s.startsWith("/-/esm.sh/")&&!s.endsWith(".js")&&!s.endsWith(".css"))&&(p+=".js"),s.endsWith(".css")&&!d.has("module")&&(c="text/css; charset=utf-8");let a=new Headers({"Content-Type":c}),x=Nt(),g=null;if(x)g=`W/${btoa(s).replace(/[^a-z0-9]/g,"")}-${x}`;else{let w=await Deno.lstat(p);if(!w.isFile)return new Response("Not Found",{status:404});let{mtime:u,size:l}=w;u&&(g=`W/${u.getTime().toString(16)}-${l.toString(16)}`,a.append("Last-Modified",new Date(u).toUTCString()))}if(g&&t.headers.get("If-None-Match")===g)return new Response(null,{status:304});let S=await Deno.open(p,{read:!0});return g&&a.append("Etag",g),(d.get("v")||s.startsWith("/-/")&&_t.test(s))&&a.append("Cache-Control","public, max-age=31536000, immutable"),new Response(kt(S),{headers:a})}catch(p){return p instanceof Deno.errors.NotFound?new Response("Not Found",{status:404}):(Mt.error(p),new Response("Internal Server Error",{status:500}))}}};var Ke=(t={})=>{let{routes:r,unocss:o,build:s,devServer:d,middlewares:p,fetch:c,ssr:a,logLevel:x,onError:g}=t,S=Deno.env.get("ALEPH_ENV")==="development",w=async(f,D)=>{let E=new URL(f.url),{pathname:y,searchParams:v}=E;if(y==="/-/hmr"){let{socket:n,response:i}=Deno.upgradeWebSocket(f,{});return n.addEventListener("open",()=>{n.send(JSON.stringify({type:"reload"})),setTimeout(()=>{n.close()},50)}),i}let _=[],R=[],m=$t(f,{connInfo:D,customHTMLRewriter:R});if(Array.isArray(p))for(let n=0,i=p.length;n<i;n++){let C=p[n],M=C.fetch;if(typeof M=="function")if(C.eager)try{let T=M(f,m);if(T instanceof Promise&&(T=await T),T instanceof Response)return T;typeof T=="function"&&setTimeout(T,0)}catch(T){let X=g?.(T,{by:"middleware",url:f.url,context:m});return X instanceof Response?X:(I.error(`[middleare${C.name?`(${C.name})`:""}]`,T),new Response(J(T.stack??T.message),{status:500,headers:[["Content-Type","text/html"]]}))}else _.push(C)}if(se.test(y))try{let n=await j("__ALEPH_IMPORT_MAP",ye),i=await j("__ALEPH_JSX_CONFIG",()=>Ve(n));return await se.fetch(f,{importMap:n,jsxConfig:i,buildTarget:s?.target,isDev:S})}catch(n){if(n instanceof We){let i=ze(Xe());return new Response(`import { showTransformError } from "${i}/framework/core/error.ts";showTransformError(${JSON.stringify(n)});`,{headers:[["Content-Type","application/javascript"]]})}if(!(n instanceof Deno.errors.NotFound))return I.error(n),g?.(n,{by:"transplie",url:f.url})??new Response(J(n.stack??n.message),{status:500,headers:[["Content-Type","text/html"]]})}let P=(await j("__ALEPH_MODULE_LOADERS",Ut)).find(n=>n.test(y));if(P)try{let n=await j("__ALEPH_IMPORT_MAP",ye),i=await j("__ALEPH_JSX_CONFIG",()=>Ve(n));return await se.fetch(f,{loader:P,importMap:n,jsxConfig:i,buildTarget:s?.target,isDev:S})}catch(n){if(n instanceof We){let i=ze(Xe());return new Response(`import { showTransformError } from "${i}/framework/core/error.ts";showTransformError(${JSON.stringify(n)});`,{headers:[["Content-Type","application/javascript"]]})}if(!(n instanceof Deno.errors.NotFound))return I.error(n),g?.(n,{by:"transplie",url:f.url})??new Response(J(n.stack??n.message),{status:500,headers:[["Content-Type","text/html"]]})}let k=Ot(y);if(!y.startsWith("/.")&&k!=="application/octet-stream")try{let n=`.${y}`,i=await Deno.lstat(n);if(i.isDirectory&&y!=="/"&&(n=`${Ge.trimSuffix(n,"/")}/index.html`,i=await Deno.lstat(n)),i.isFile){let C=new Headers({"Content-Type":k}),M=jt(),T=null;if(M)T=`W/${btoa(y).replace(/[^a-z0-9]/g,"")}-${M}`;else{let{mtime:z,size:Ye}=i;z&&(T=`W/${z.getTime().toString(16)}-${Ye.toString(16)}`,C.append("Last-Modified",new Date(z).toUTCString()))}if(T){if(f.headers.get("If-None-Match")===T)return new Response(null,{status:304});C.append("ETag",T)}(v.get("v")||Bt.test(y))&&C.append("Cache-Control","public, max-age=31536000, immutable");let X=await Deno.open(n,{read:!0});return new Response(Ht(X),{headers:C})}}catch(n){if(!(n instanceof Deno.errors.NotFound))return I.error(n),g?.(n,{by:"fs",url:f.url})??new Response(J(n.stack??n.message),{status:500,headers:[["Content-Type","text/html"]]})}for(let n of _)try{let i=n.fetch(f,m);if(i instanceof Promise&&(i=await i),i instanceof Response)return i;typeof i=="function"&&setTimeout(i,0)}catch(i){let C=g?.(i,{by:"middleware",url:f.url,context:m});return C instanceof Response?C:(I.error(`[middleare${n.name?`(${n.name})`:""}]`,i),new Response(J(i.stack??i.message),{status:500,headers:[["Content-Type","text/html"]]}))}if(typeof c=="function")return c(f,m);let H=await j("__ALEPH_ROUTES",()=>r?Xt(r):Promise.resolve({routes:[]}));if(H.routes.length>0){let n=f.method==="GET"&&(E.searchParams.has("_data_")||f.headers.get("Accept")==="application/json");try{let i=await Jt(H.routes,E,f,m,n);if(i)return i}catch(i){if(i instanceof TypeError&&!n)return new Response(J(i.stack??i.message),{status:500,headers:[["Content-Type","text/html"]]});let C=g?.(i,{by:"route-data-fetch",url:f.url,context:m});if(C instanceof Response)return Je(C,m.headers,n);if(i instanceof Response)return Je(i,m.headers,n);(i instanceof Error||typeof i=="string")&&I.error(i);let M=Ge.isUint(i.status??i.code)?i.status??i.code:500;return Response.json({...i,status:M,message:i.message??String(i),stack:i.stack},{status:M,headers:m.headers})}}switch(y){case"/favicon.ico":case"/robots.txt":return new Response("Not found",{status:404})}try{let n=await j("__ALEPH_IMPORT_MAP",ye),i=await j("__ALEPH_INDEX_HTML",()=>Wt({isDev:S,importMap:n,ssr:typeof a=="function"?{}:a,hmrWebSocketUrl:t.devServer?.hmrWebSocketUrl}));return Gt.fetch(f,m,{indexHtml:i,routeTable:H,customHTMLRewriter:R,isDev:S,ssr:a})}catch(n){if(n instanceof Response)return n;let i;n instanceof Error?(i=n.stack,I.error("SSR",n)):i=n?.toString?.()||String(n);let C=a&&typeof a!="function"?a.cacheControl:"public";return m.headers.append("Cache-Control",`${C}, max-age=0, must-revalidate`),m.headers.append("Content-Type","text/html; charset=utf-8"),new Response(J(i,"SSR"),{headers:m.headers})}};x&&I.setLevel(x),Reflect.set(globalThis,"__ALEPH_CONFIG",{routes:r,unocss:o,build:s,devServer:d}),Reflect.set(globalThis,"__ALEPH_CLIENT_DEP_GRAPH",new It);let{hostname:u,port:l=8080,certFile:h,keyFile:b,signal:L}=t;Deno.env.get("ALEPH_CLI")?Reflect.set(globalThis,"__ALEPH_SERVER",{hostname:u,port:l,certFile:h,keyFile:b,handler:w,signal:L}):(h&&b?Ft(w,{hostname:u,port:l,certFile:h,keyFile:b,signal:L}):At(w,{hostname:u,port:l,signal:L}),I.info(`Server ready on http://localhost:${l}`))};import{renderToReadableStream as Vt}from"https://esm.sh/react-dom@18.1.0/server";Ke({routes:"./src/pages/**/*.{tsx,ts}",ssr:{dataDefer:!1,render:t=>Vt(e.createElement(le,{ssrContext:t}),t)}});globalThis.__ALEPH_SERVER_DEP_GRAPH=new zt(Kt.modules);Q("./src/pages/_404.tsx",{E404:pe,default:Ae});Q("./src/pages/_app.tsx",{App:fe,default:Fe});Q("./src/pages/game.tsx",{data:Ie,Game:ge,default:je});Q("./src/pages/index.tsx",{Index:we,default:Ue});Q("./src/pages/api/user.ts",{handler:Be});
//# sourceMappingURL=server.js.map
